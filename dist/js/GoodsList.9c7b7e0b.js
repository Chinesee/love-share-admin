(window.webpackJsonp=window.webpackJsonp||[]).push([["GoodsList"],{"28a5":function(t,e,s){"use strict";var i=s("aae3"),a=s("cb7c"),l=s("ebd6"),n=s("0390"),o=s("9def"),r=s("5f1b"),c=s("520a"),d=s("79e5"),u=Math.min,g=[].push,f=!d(function(){RegExp(4294967295,"y")});s("214f")("split",2,function(t,e,s,d){var h;return h="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var a=String(this);if(void 0===t&&0===e)return[];if(!i(t))return s.call(a,t,e);for(var l,n,o,r=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,f=void 0===e?4294967295:e>>>0,h=new RegExp(t.source,d+"g");(l=c.call(h,a))&&!((n=h.lastIndex)>u&&(r.push(a.slice(u,l.index)),l.length>1&&l.index<a.length&&g.apply(r,l.slice(1)),o=l[0].length,u=n,r.length>=f));)h.lastIndex===l.index&&h.lastIndex++;return u===a.length?!o&&h.test("")||r.push(""):r.push(a.slice(u)),r.length>f?r.slice(0,f):r}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:s.call(this,t,e)}:s,[function(s,i){var a=t(this),l=null==s?void 0:s[e];return void 0!==l?l.call(s,a,i):h.call(String(a),s,i)},function(t,e){var i=d(h,t,this,e,h!==s);if(i.done)return i.value;var c=a(t),g=String(this),p=l(c,RegExp),v=c.unicode,m=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(f?"y":"g"),b=new p(f?c:"^(?:"+c.source+")",m),y=void 0===e?4294967295:e>>>0;if(0===y)return[];if(0===g.length)return null===r(b,g)?[g]:[];for(var _=0,x=0,C=[];x<g.length;){b.lastIndex=f?x:0;var L,k=r(b,f?g:g.slice(x));if(null===k||(L=u(o(b.lastIndex+(f?0:x)),g.length))===_)x=n(g,x,v);else{if(C.push(g.slice(_,x)),C.length===y)return C;for(var w=1;w<=k.length-1;w++)if(C.push(k[w]),C.length===y)return C;x=_=L}}return C.push(g.slice(_)),C}]})},"384b":function(t,e,s){"use strict";s.r(e);var i=s("1da1"),a=s("5530"),l=s("5880");s("28a5");const n={shortcuts:[{text:"最近一周",onClick(t){const e=new Date,s=new Date;s.setTime(s.getTime()-6048e5),t.$emit("pick",[s,e])}},{text:"最近一个月",onClick(t){const e=new Date,s=new Date;s.setTime(s.getTime()-2592e6),t.$emit("pick",[s,e])}},{text:"最近三个月",onClick(t){const e=new Date,s=new Date;s.setTime(s.getTime()-7776e6),t.$emit("pick",[s,e])}}]};var o={name:"ListTable",props:{goodsList:{type:Array,default:()=>[]},tableTitle:{type:String,default:"已上架商品"},loading:{type:Boolean,default:!1}},data:()=>({pickerOptions:n,date:null}),watch:{loading(t){t?this.$vs.loading({type:"point",container:"#table-list",scale:1}):this.$vs.loading.close("#table-list > .con-vs-loading")}},filters:{creditText:t=>t>=500&&t<=690?"良好":t>690?"极好":t<490&&t>=390?"一般":"差劲",creditColor:t=>t>=500&&t<=690?"success":t>690?"primary":t<490&&t>=390?"warning":"danger"},methods:{viewGoodsDetail(t){this.$router.push({path:"/goods-detail",query:{goodsId:t}})},viewUserDetail(t){this.$router.push({path:"/user-detail",query:{userId:t}})},onDateChange(t){if(t){const e=t.map(t=>this.$dayjs(t).format("YYYY-MM-DD"));this.$emit("dateChange",e)}else this.$emit("getGoodsListOnSell")},onCopy(t){this.$message(`已复制商品编号：${t.text}  🎉`)},formatTime(t){return this.$dayjs(t).format("YYYY/MM/DD HH:mm:ss")},exportExcel(){Promise.all([s.e("chunk-6e83591c"),s.e("chunk-40d08246"),s.e("chunk-52736ebc")]).then(s.bind(null,"4bf8d")).then(t=>{const e=this.formatJson(["_id","name","price","seller.nickname","seller.real_name","collect_num","views","created_at"],this.goodsList);t.export_json_to_excel({header:["商品 ID","商品名称","价格","卖家昵称","卖家姓名","收藏数","浏览量","发布时间"],data:e,filename:"乐享校园_商品列表",autoWidth:!0,bookType:"xlsx"})})},formatJson:(t,e)=>e.map(e=>t.map(t=>{const s=t.split(".");return 1===s.length?e[s[0]]:e[s[0]][s[1]]}))}},r=(s("c399"),s("2877")),c=Object(r.a)(o,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"radius vs-con-loading__container",attrs:{id:"table-list"}},[s("vs-table",{attrs:{pagination:"","max-items":"10",noDataText:"暂无数据",data:t.goodsList},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[t._l(i,function(e,i){return[e.seller?s("vs-tr",{key:i},[s("vs-td",{staticClass:"text-primary"},[t._v(t._s(e.name))]),s("vs-td",t._l(e.category,function(e,i){return s("vs-chip",{key:i},[t._v(t._s(e.name))])}),1),s("vs-td",{staticClass:"text-gray font-bold"},[t._v("￥"+t._s(t.$numFixed(e.price)))]),s("vs-td",{staticClass:"text-gray font-bold"},[t._v(t._s(e.seller.nickname))]),s("vs-td",{staticClass:"text-semi"},[t._v(t._s(e.collect_num))]),s("vs-td",{staticClass:"text-semi"},[t._v(t._s(e.views))]),s("vs-td",{staticClass:"text-semi cursor-pointer",attrs:{title:"查看详情"},nativeOn:{click:function(s){return s.stopPropagation(),t.viewGoodsDetail(e._id)}}},[s("feather",{attrs:{size:"18",type:"log-in"}})],1),s("template",{slot:"expand"},[s("div",{staticClass:"flex w-full"},[s("el-image",{staticClass:"w-2/12 m-4 p-4 radius base-shadow",attrs:{fit:"contain",src:e.img_list[0]+"?imageView2/2/w/200"}}),s("vs-list",{staticClass:"w-4/12 ml-4"},[s("vs-list-header",{staticClass:"text-base",attrs:{title:"商品信息"}}),s("vs-list-item",{attrs:{"icon-pack":"el-icon",icon:"el-icon-collection-tag",title:"商品 ID",subtitle:e._id}},[s("vs-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e._id,expression:"tr._id",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.onCopy,expression:"onCopy",arg:"success"}],attrs:{type:"flat",size:"small"}},[t._v("复制")])],1),s("vs-list-item",{attrs:{"icon-pack":"el-icon",icon:"el-icon-time",title:"发布时间",subtitle:t.formatTime(e.created_at)}},[s("vs-button",{attrs:{type:"flat",size:"small"},on:{click:function(s){return t.viewGoodsDetail(e._id)}}},[t._v("查看商品详情")])],1)],1),s("vs-list",{staticClass:"w-4/12"},[s("vs-list-header",{staticClass:"text-base",attrs:{title:"卖家信息",color:"success"}}),s("vs-list-item",{attrs:{"icon-pack":"el-icon",icon:"el-icon-user",title:"真实姓名",subtitle:e.seller.real_name}}),s("vs-list-item",{attrs:{"icon-pack":"el-icon",icon:"el-icon-star-off",title:"乐享值",subtitle:""+e.seller.share_value}})],1),s("div",{staticClass:"flex-1"},[s("div",{staticClass:"flex flex-col h-full justify-center items-center"},[s("vs-avatar",{attrs:{size:"45px",src:e.seller.avatar_url},on:{click:function(s){return t.viewUserDetail(e.seller._id)}}}),s("div",{staticClass:"my-2 text-gray text-base\n                    font-semibold cursor-pointer",on:{click:function(s){return t.viewUserDetail(e.seller._id)}}},[t._v(t._s(e.seller.nickname))]),s("vs-chip",{attrs:{color:t._f("creditColor")(e.seller.credit_value)}},[t._v("\n                    乐享信用 "+t._s(t._f("creditText")(e.seller.credit_value))+"\n                  ")])],1)])],1)])],2):t._e()]})]}}])},[s("template",{slot:"header"},[s("div",{staticClass:"w-full flex items-center p-4"},[s("div",{staticClass:"text-xl font-semibold",class:"已上架商品"===t.tableTitle?"primary":"danger"},[t._v(t._s(t.tableTitle))]),s("div",{staticClass:"ml-auto flex items-center"},[s("el-tooltip",{attrs:{content:"导出列表数据"}},[s("div",{staticClass:"w-10 h-10 mr-5 flex-row-center primary-semi\n               rounded-lg bg-primary-10 cursor-pointer",on:{click:function(e){return t.exportExcel()}}},[s("feather",{attrs:{size:"21","stroke-width":"1.8",type:"download"}})],1)]),s("el-date-picker",{attrs:{"unlink-panels":"",type:"daterange",align:"right","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions},on:{change:t.onDateChange},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)])]),s("template",{slot:"thead"},[s("vs-th",[t._v("商品名称")]),s("vs-th",[t._v("分类")]),s("vs-th",[t._v("单价")]),s("vs-th",[t._v("卖家昵称")]),s("vs-th",[t._v("收藏数")]),s("vs-th",[t._v("浏览量")]),s("vs-th")],1)],2)],1)},[],!1,null,"20fcfc8a",null).exports,d=s("67cf"),u={name:"GoodsList",components:{ListTable:c},data:()=>({goodsList:[],selectedCategory:"",selectedSchool:"",tableTitle:null,onSellCount:"--",offSellCount:"--",searchId:"",searchText:"",tableLoading:!1,hideFilters:!1}),computed:Object(a.a)({},Object(l.mapState)(["categoryList","schoolList"]),{filtersStyle(){return this.hideFilters?{transform:"rotate(-180deg)"}:{transform:"rotate(0)"}},inputStyle(){return this.hideFilters?{opacity:"0","max-height":"0",padding:"0"}:{opacity:"1","max-height":"200px"}},goodsListLength(){return this.goodsList.length}}),activated(){this.getGoodsListOnSell(),this.getGoodsListInfo()},methods:{getGoodsListOnSell(){var t=this;return Object(i.a)(function*(){if(!t.tableLoading){t.tableLoading=!0;try{const e=yield Object(d.i)({page:1,page_size:100}),s=e.code,i=e.data;2e3===s&&(t.tableTitle="已上架商品",t.goodsList=i.goods_list)}finally{t.tableLoading=!1}}})()},getGoodsListOffSell(){var t=this;return Object(i.a)(function*(){if(!t.tableLoading){t.tableLoading=!0;try{const e=yield Object(d.h)({page:1,page_size:100}),s=e.code,i=e.data;2e3===s&&(t.tableTitle="已下架商品",t.goodsList=i.goods_list)}finally{t.tableLoading=!1}}})()},getGoodsListByDateRange(t){var e=this;return Object(i.a)(function*(){if(!e.tableLoading){e.tableLoading=!0;try{const s=yield Object(d.d)({date_range:t,page:1,page_size:100}),i=s.code,a=s.data;2e3===i&&(e.tableTitle="已上架商品",e.goodsList=a.goods_list)}finally{e.tableLoading=!1}}})()},getGoodsListBySelect(){var t=this;return Object(i.a)(function*(){if(!t.tableLoading&&(t.selectedCategory||t.selectedSchool)){t.tableLoading=!0;try{const e=yield Object(d.f)({category:t.selectedCategory,school_id:t.selectedSchool,page:1,page_size:100}),s=e.code,i=e.data;2e3===s&&(t.tableTitle="已上架商品",t.goodsList=i.goods_list)}finally{t.tableLoading=!1}}})()},getGoodsListBySearchAdmin(){var t=this;return Object(i.a)(function*(){if(!t.tableLoading&&t.searchText.length>0){t.tableLoading=!0;try{const e=yield Object(d.e)({search:t.searchText,page:1,page_size:100}),s=e.code,i=e.data;2e3===s&&(t.tableTitle="已上架商品",t.goodsList=i.goods_list)}finally{t.tableLoading=!1}}})()},getGoodsListInfo(){var t=this;return Object(i.a)(function*(){const e=yield Object(d.g)(),s=e.code,i=e.data;2e3===s&&(t.onSellCount=i.on_sell_count,t.offSellCount=i.off_sell_count)})()},onSearchByID(){this.searchId.length>0&&(this.$router.push({path:"/goods-detail",query:{goodsId:this.searchId}}),this.searchId="")},onReset(){this.selectedCategory="",this.selectedSchool="",this.searchText="",this.getGoodsListOnSell()}}},g=(s("7c45"),Object(r.a)(u,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"flex mt-3 mb-6"},[s("div",{staticClass:"box w-1/4 lg:px-6 px-3 radius bg-gray",on:{click:function(e){return t.getGoodsListOnSell()}}},[s("div",[s("div",{staticClass:"text-3xl text-primary"},[t._v("\n          "+t._s(t.onSellCount.toLocaleString())+"\n        ")]),s("div",{staticClass:"text-semi"},[t._v("已上架商品")])]),t._m(0)]),s("div",{staticClass:"box w-1/4 mx-5 lg:px-6 px-3 radius bg-gray",on:{click:function(e){return t.getGoodsListOffSell()}}},[s("div",[s("div",{staticClass:"text-3xl text-primary"},[t._v("\n          "+t._s(t.offSellCount.toLocaleString())+"\n        ")]),s("div",{staticClass:"text-semi"},[t._v("已下架商品")])]),t._m(1)]),s("div",{staticClass:"w-2/4 py-6 px-6 radius bg-gray"},[s("div",{staticClass:"mb-3 text-semi"},[t._v("高级操作")]),s("div",{staticClass:"flex items-center justify-between text-sm"},[s("div",{staticClass:"w-1/2"},[s("vs-input",{staticClass:"search-input w-full",attrs:{icon:"search",placeholder:"输入商品的 ID 搜索"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearchByID(e)}},model:{value:t.searchId,callback:function(e){t.searchId=e},expression:"searchId"}})],1)])])]),s("div",{staticClass:"mb-6 py-4 px-6 radius base-shadow bg-semi"},[s("div",{staticClass:"flex items-center justify-between text-semi"},[s("div",[t._v("过滤搜索")]),s("div",[s("i",{staticClass:"el-icon-arrow-down mr-2 cursor-pointer",staticStyle:{transition:"transform 0.3s"},style:t.filtersStyle,attrs:{title:t.hideFilters?"展开":"收起"},on:{click:function(e){t.hideFilters=!t.hideFilters}}}),s("i",{staticClass:"el-icon-refresh-right cursor-pointer",attrs:{title:"重置"},on:{click:function(e){return t.onReset()}}})])]),s("div",{staticClass:"transition",style:t.inputStyle},[s("div",{staticClass:"pt-8 pb-2 flex items-center flex-wrap overflow-hidden"},[s("div",{staticClass:"mr-4"},[s("el-select",{attrs:{filterable:"",placeholder:"根据商品分类搜索"},model:{value:t.selectedCategory,callback:function(e){t.selectedCategory=e},expression:"selectedCategory"}},t._l(t.categoryList,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t._id}})}),1)],1),s("div",{staticClass:"mr-4"},[s("el-select",{attrs:{filterable:"",placeholder:"根据学校搜索"},model:{value:t.selectedSchool,callback:function(e){t.selectedSchool=e},expression:"selectedSchool"}},t._l(t.schoolList,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t._id}})}),1)],1),s("div",[s("vs-button",{staticClass:"w-32 text-sm",attrs:{type:"relief"},on:{click:function(e){return t.getGoodsListBySelect()}}},[t._v("确认搜索")])],1)]),s("div",{staticClass:"pb-2 flex items-end"},[s("div",{staticClass:"w-1/2 pt-3 flex items-center"},[s("vs-input",{staticClass:"mr-4 flex-1",attrs:{placeholder:"输入商品的名称搜索"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getGoodsListBySearchAdmin()}},model:{value:t.searchText,callback:function(e){t.searchText="string"==typeof e?e.trim():e},expression:"searchText"}}),s("vs-button",{staticClass:"w-32 text-sm",attrs:{type:"relief"},on:{click:function(e){return t.getGoodsListBySearchAdmin()}}},[t._v("搜 索")])],1),s("div",{staticClass:"ml-auto text-gray"},[t._v("\n          已搜索到 "+t._s(t.goodsListLength)+" 件商品\n        ")])])])]),s("ListTable",{attrs:{goodsList:t.goodsList,tableTitle:t.tableTitle,loading:t.tableLoading},on:{getGoodsListOnSell:t.getGoodsListOnSell,dateChange:t.getGoodsListByDateRange}})],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rounded-full",staticStyle:{background:"rgba(var(--vs-primary), 0.2)"}},[e("i",{staticClass:"el-icon-sell p-2 text-3xl primary"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rounded-full",staticStyle:{background:"rgba(var(--vs-danger), 0.2)"}},[e("i",{staticClass:"el-icon-sold-out p-2 text-3xl danger"})])}],!1,null,"a9bc5a2e",null));e.default=g.exports},"67cf":function(t,e,s){"use strict";s.d(e,"i",function(){return a}),s.d(e,"h",function(){return l}),s.d(e,"d",function(){return n}),s.d(e,"f",function(){return o}),s.d(e,"e",function(){return r}),s.d(e,"g",function(){return c}),s.d(e,"c",function(){return d}),s.d(e,"k",function(){return u}),s.d(e,"j",function(){return g}),s.d(e,"b",function(){return f}),s.d(e,"a",function(){return h});var i=s("284b");function a(t){return Object(i.a)({url:"/goods/list/on_sell",method:"get",params:t})}function l(t){return Object(i.a)({url:"/goods/list/off_sell",method:"get",params:t})}function n(t){return Object(i.a)({url:"/goods/list/by_date_range",method:"post",data:t})}function o(t){return Object(i.a)({url:"/goods/list/by_school_or_category_admin",method:"get",params:t})}function r(t){return Object(i.a)({url:"/goods/list/by_search_admin",method:"get",params:t})}function c(){return Object(i.a)({url:"/goods/list/info",method:"get"})}function d(t){return Object(i.a)({url:"/goods/detail",method:"get",params:t})}function u(t){return Object(i.a)({url:"/goods/update_many",method:"put",data:t})}function g(t){return Object(i.a)({url:"/goods/seller",method:"get",params:t})}function f(t){return Object(i.a)({url:"/goods/comments",method:"get",params:t})}function h(t){return Object(i.a)({url:"/goods/comment/change",method:"put",data:t})}},"71ab":function(t,e,s){},"7c45":function(t,e,s){"use strict";var i=s("71ab");s.n(i).a},a47c:function(t,e,s){},aae3:function(t,e,s){var i=s("d3f4"),a=s("2d95"),l=s("2b4c")("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[l])?!!e:"RegExp"==a(t))}},c399:function(t,e,s){"use strict";var i=s("a47c");s.n(i).a},ebd6:function(t,e,s){var i=s("cb7c"),a=s("d8e8"),l=s("2b4c")("species");t.exports=function(t,e){var s,n=i(t).constructor;return void 0===n||null==(s=i(n)[l])?e:a(s)}}}]);