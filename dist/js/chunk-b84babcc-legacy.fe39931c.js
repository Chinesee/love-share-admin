(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b84babcc"],{"0a78":function(t,e,a){"use strict";a.r(e);a("96cf");var n=a("3b8d"),o=(a("28a5"),a("7e79")),r=a("518e"),i={name:"ReplaceAvatar",components:{VueCropper:o.VueCropper},props:{adminId:String,popupActive:{type:Boolean,required:!0}},data:function(){return{avatarBase64:"",avatarUrl:"",btnDisable:!1,showAlert:!1,alertText:""}},computed:{showPopup:{get:function(){return this.popupActive},set:function(t){t||this.$emit("closePopup")}}},watch:{popupActive:function(t){t&&(this.showPopup=!0)}},methods:{onShowAlert:function(t){this.showAlert=!0,this.alertText=t},getImage:function(t){var e=this,a=t.target.files;if(a){if(!(a[0].size/1024/1024<2))return void this.onShowAlert("图片大小不能超过 2MB！");var n=new FileReader;n.readAsDataURL(a[0]),n.onload=function(t){var a=t.target.result;e.avatarBase64=a}}},onReplace:function(){var t=this;this.$refs.cropper.getCropBlob(function(e){var a="".concat(Date.now(),".").concat(e.type.split("/")[1]),o=new FormData;o.append("avatar",e,a),o.append("id",t.adminId),t.$loading(Object(n.a)(regeneratorRuntime.mark(function e(){var a,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.btnDisable=!0,e.next=3,Object(r.o)(o);case 3:if(a=e.sent,n=a.code,i=a.data.avatar_url,2e3!==n){e.next=13;break}return e.next=9,Object(r.i)({admin_id:t.adminId,avatar_url:i});case 9:2e3===e.sent.code&&(t.avatarUrl=i,t.adminId===t.$store.getters["admin/adminId"]&&(t.$emit("updateInfo"),t.$store.commit("admin/SET_AVATAR",i)),t.$vs.notify({time:3e3,title:"图片上传成功",text:"头像已更换",color:"success"}),t.showPopup=!1),e.next=14;break;case 13:3e3!==n&&4003!==n&&5e3!==n||(t.showAlert=!0);case 14:case"end":return e.stop()}},e)})),{background:"primary",color:"#fff",container:"#replaceBtn",scale:.45},function(){t.btnDisable=!1},function(){t.onShowAlert("图片上传失败，请重试！")})})}}},c=(a("1fdc"),a("2877")),s=Object(c.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("vs-popup",{staticClass:"avatar-popup",attrs:{title:"更换头像",active:t.showPopup},on:{"update:active":function(e){t.showPopup=e}}},[a("div",[a("div",{staticClass:"flex flex-col justify-center items-center"},[a("vueCropper",{ref:"cropper",staticStyle:{width:"300px",height:"300px"},attrs:{outputType:"jpeg",info:!1,outputSize:.8,canMove:!1,canMoveBox:!0,canScale:!0,autoCrop:!0,centerBox:!0,fixed:!0,infoTrue:!0,img:t.avatarBase64}}),a("div",{staticClass:"w-full"},[a("vs-alert",{attrs:{closable:"","close-icon":"close",color:"danger",active:t.showAlert},on:{"update:active":function(e){t.showAlert=e}}},[t._v("\n          "+t._s(t.alertText)+"\n        ")])],1),a("div",{staticClass:"text-center"},[a("vs-button",{staticClass:"my-1",attrs:{type:"flat"},on:{click:function(e){return t.$refs.fileInput.click()}}},[t._v("选择图片")]),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpeg,image/jpg,image/png"},on:{change:t.getImage}})],1),a("vs-button",{staticClass:"w-full vs-con-loading__container",attrs:{id:"replaceBtn",disabled:t.btnDisable},on:{click:function(e){return t.onReplace()}}},[t._v("确认更换")])],1)])])},[],!1,null,"ea5b7b60",null);e.default=s.exports},"19b1":function(t,e,a){},"1fdc":function(t,e,a){"use strict";var n=a("19b1");a.n(n).a}}]);