(window.webpackJsonp=window.webpackJsonp||[]).push([["GoodsDetail"],{2959:function(t,e,s){"use strict";var n=s("4a45");s.n(n).a},"4a45":function(t,e,s){},"67cf":function(t,e,s){"use strict";s.d(e,"i",function(){return r}),s.d(e,"h",function(){return a}),s.d(e,"d",function(){return i}),s.d(e,"f",function(){return o}),s.d(e,"e",function(){return c}),s.d(e,"g",function(){return l}),s.d(e,"c",function(){return d}),s.d(e,"k",function(){return u}),s.d(e,"j",function(){return m}),s.d(e,"b",function(){return g}),s.d(e,"a",function(){return f});var n=s("284b");function r(t){return Object(n.a)({url:"/goods/list/on_sell",method:"get",params:t})}function a(t){return Object(n.a)({url:"/goods/list/off_sell",method:"get",params:t})}function i(t){return Object(n.a)({url:"/goods/list/by_date_range",method:"post",data:t})}function o(t){return Object(n.a)({url:"/goods/list/by_school_or_category_admin",method:"get",params:t})}function c(t){return Object(n.a)({url:"/goods/list/by_search_admin",method:"get",params:t})}function l(){return Object(n.a)({url:"/goods/list/info",method:"get"})}function d(t){return Object(n.a)({url:"/goods/detail",method:"get",params:t})}function u(t){return Object(n.a)({url:"/goods/update_many",method:"put",data:t})}function m(t){return Object(n.a)({url:"/goods/seller",method:"get",params:t})}function g(t){return Object(n.a)({url:"/goods/comments",method:"get",params:t})}function f(t){return Object(n.a)({url:"/goods/comment/change",method:"put",data:t})}},"881a":function(t,e,s){"use strict";var n=s("9a12");s.n(n).a},"9a12":function(t,e,s){},d1c9:function(t,e,s){"use strict";var n=s("e0f9");s.n(n).a},e0f9:function(t,e,s){},e855:function(t,e,s){"use strict";s.r(e);s("a481"),s("96cf");var n=s("3b8d"),r=s("08a9"),a=s("67cf"),i={name:"DetailInfo",components:{ElImageViewer:r.a},props:{goods:Object,goodsId:String},data:function(){return{showViewer:!1}},methods:{updateGoodsStatus:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(a.k)({goods_id_list:[this.goodsId],status:e});case 2:s=t.sent,2e3===s.code&&(1===e?this.$message.info("此商品已重新上架"):this.$message.error("此商品已被下架"));case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}},o=(s("881a"),s("2877")),c=Object(o.a)(i,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"relative p-6 bg-main rounded-lg overflow-hidden"},[s("div",{staticClass:"flex"},[s("div",{staticStyle:{width:"60%"}},[s("el-carousel",{attrs:{autoplay:!1}},t._l(t.goods.img_list,function(t,e){return s("el-carousel-item",{key:e,staticStyle:{display:"flex","justify-content":"center"}},[s("img",{staticClass:"h-full",staticStyle:{"max-width":"inherit"},attrs:{src:t}})])}),1),s("vs-images",{attrs:{hover:"zoom"}},t._l(t.goods.img_list,function(e,n){return s("vs-image",{key:n,attrs:{src:e+"?imageView2/2/w/100"},nativeOn:{click:function(e){t.showViewer=!0}}})}),1)],1),s("div",{staticClass:"pl-5",staticStyle:{width:"40%"}},[s("p",{staticClass:"text-primary text-lg font-bold"},[t._v(t._s(t.goods.name))]),s("div",{staticClass:"my-2 text-gray text-sm"},[s("p",[s("span",[t._v("发布于 "+t._s(t.$timeDiff(t.goods.created_at))+"，已被浏览")]),s("span",{staticClass:"mx-1"},[t._v(t._s(t.goods.views))]),s("span",[t._v("次，共有 "+t._s(t.goods.collect_num)+" 人收藏")])])]),s("vs-divider",{attrs:{"border-style":"dashed"}}),s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("类 别")]),t._l(t.goods.category,function(e,n){return s("span",{key:n,staticClass:"text-gray",staticStyle:{margin:"0 5px 4px 0","font-size":"15px"}},[t._v("\n          "+t._s(e.name)+"\n        ")])})],2),s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("价 格")]),s("div",[s("span",{staticClass:"text-2xl text-primary font-semibold"},[t._v("\n            ￥"+t._s(t.$numFixed(t.goods.price))+"\n          ")]),0!==t.goods.original_price?s("span",{staticClass:"text-gray",staticStyle:{"text-decoration":"line-through"}},[t._v("\n            ￥"+t._s(t.$numFixed(t.goods.original_price))+"\n          ")]):t._e()])],1),s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("新 旧")]),s("span",{staticClass:"font-bold",class:{success:t.goods.degree>70,warning:t.goods.degree>=30&&t.goods.degree<70,danger:t.goods.degree<30},staticStyle:{"margin-bottom":"2px"}},[t._v("\n          "+t._s(t.goods.degree)+"%\n        ")])],1),s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("数 量")]),s("span",{staticClass:"text-gray",staticStyle:{"margin-bottom":"2px"}},[t._v(t._s(t.goods.quantity))])],1),s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("配 送")]),s("span",{staticClass:"text-gray",staticStyle:{"margin-bottom":"4px","font-size":"15px"}},[t._v("\n          "+t._s("1"===t.goods.delivery?"包邮":"2"===t.goods.delivery?"自费":"自提")+"\n        ")]),"2"===t.goods.delivery?s("span",{staticClass:"text-gray",staticStyle:{"margin-bottom":"4px","font-size":"15px"}},[t._v("\n          (￥"+t._s(t.$numFixed(t.goods.delivery_charge))+")\n        ")]):t._e()],1),t.goods.returnable?s("div",{staticClass:"info-item"},[s("vs-chip",[t._v("保 障")]),s("span",{staticStyle:{"margin-bottom":"4px","font-size":"15px"}},[t._v("\n          7天无理由退换货\n        ")])],1):t._e(),s("vs-divider",{attrs:{"border-style":"dashed"}}),s("div",{staticClass:"flex items-center justify-between"},[1===t.goods.status?s("vs-button",{attrs:{color:"success"}},[t._v("此商品正在出售中")]):t._e(),2===t.goods.status?s("vs-button",{attrs:{color:"warning"}},[t._v("此商品已售出")]):t._e(),3===t.goods.status?s("vs-button",{attrs:{color:"danger",disabled:!0}},[t._v("该商品已下架")]):t._e(),s("div",{staticClass:"w-10 h-10 flex-row-center radius cursor-pointer",class:{"danger-semi bg-danger-10":1===t.goods.status,"primary-semi bg-primary-10":3===t.goods.status},attrs:{title:1===t.goods.status?"下架":"上架"},on:{click:function(e){1===t.goods.status?t.updateGoodsStatus(3):t.updateGoodsStatus(1)}}},[s("feather",{attrs:{size:"20",type:1===t.goods.status?"trending-down":"trending-up"}})],1)],1)],1)]),s("div",{staticClass:"mt-4"},[s("p",{staticClass:"text-primary"},[t._v("商品详细介绍")]),s("div",{staticClass:"mt-2 text-sm text-semi goods-desc",domProps:{innerHTML:t._s(t.goods.description)}})]),s("el-image-viewer",{directives:[{name:"show",rawName:"v-show",value:t.showViewer,expression:"showViewer"}],attrs:{"on-close":function(){t.showViewer=!1},"url-list":t.goods.img_list}})],1)},[],!1,null,"3912dd64",null).exports,l={name:"DetailUser",props:{seller:Object},methods:{viewUserDetail:function(t){this.$router.push({path:"/user-detail",query:{userId:t}})},contactSeller:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(){var e,s,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.seller,s=e._id,n=e.nickname,this.$store.getters["chat/isInChat"](s)){t.next=4;break}return t.next=4,this.$store.dispatch("chat/addContact",s);case 4:this.$store.commit("chat/SET_ACTIVE_CHAT_USER",{_id:s,nickname:n}),this.$store.commit("chat/SET_CHAT_OPEN");case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},d=(s("2959"),Object(o.a)(l,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"mb-5 p-3 text-center bg-semi base-shadow radius"},[s("vs-avatar",{attrs:{size:"90px",src:t.seller.avatar_url+"?imageView2/2/w/100"},on:{click:function(e){return t.viewUserDetail(t.seller._id)}}}),s("div",{staticClass:"flex-row-center text-lg cursor-pointer",on:{click:function(e){return t.viewUserDetail(t.seller._id)}}},[s("span",{staticClass:"text-primary"},[t._v(t._s(t.seller.nickname))]),s("i",{staticClass:"ml-1",class:"1"===t.seller.gender?"el-icon-male primary":"el-icon-female danger"})]),s("div",{staticClass:"my-1 text-sm text-gray"},[t._v("\n      "+t._s(t.seller.school.name)+"\n    ")]),s("div",{staticClass:"flex justify-around mt-3"},[s("div",[s("div",{staticClass:"text-semi font-bold"},[t._v(t._s(t.seller.published_num))]),s("div",{staticClass:"text-gray text-sm"},[t._v("已发布")])]),s("div",[s("div",{staticClass:"text-semi font-bold"},[t._v(t._s(t.seller.fans_num))]),s("div",{staticClass:"text-gray text-sm"},[t._v("关注者")])]),s("div",[s("div",{staticClass:"text-semi font-bold"},[t._v(t._s(t.seller.credit_value))]),s("div",{staticClass:"text-gray text-sm"},[t._v("信用值")])])])],1),s("div",{staticClass:"hover-light radius cursor-pointer"},[s("div",{staticClass:"py-3 flex-row-center text-center text-white\n        bg-primary-gradient rounded-lg",on:{click:function(e){return t.contactSeller()}}},[t._v("\n      联系卖家\n    ")]),s("div",{staticClass:"light"})])])},[],!1,null,"1b061f50",null).exports),u=(s("c5f6"),s("eec4")),m=s.n(u),g=s("9d63"),f={name:"DetailComment",components:{VuePerfectScrollbar:s.n(g).a},props:{goodsId:String,comments:Array,owner:String,total:Number},watch:{currPage:function(t){this.$emit("switchPage",t)}},data:function(){return{counterDanger:!0,maxHeight:500,placeholder:"",textContent:"",repContent:"",currMsg:null,currRep:null,currPage:1,hideComment:!1,showComments:!1}},userId:function(){return this.$store.getters["admin/userId"]},mounted:function(){var t=this;m()().listenTo(this.$refs.comment,function(e){e.offsetHeight>=t.maxHeight?t.hideComment=!0:t.hideComment=!1})},methods:{showMoreComments:function(){this.maxHeight=1e4,this.showComments=!0},viewUserDetail:function(t){t!==this.userId&&this.$router.push({path:"/user-detail",query:{userId:t}})},changeGoodsComments:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(a.a)({goods_id:this.goodsId,comment_id:e,content:"此用户评论涉嫌违规"});case 2:s=t.sent,2e3===s.code&&(this.$emit("refreshComments"),this.$message.success("已屏蔽留言"));case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}},p=(s("d1c9"),{name:"GoodsDetail",components:{DetailInfo:c,DetailUser:d,DetailComment:Object(o.a)(f,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"comment",staticClass:"relative p-3 bg-main rounded-lg overflow-hidden",style:"max-height: "+t.maxHeight+"px;"},[t._m(0),t.comments.length>0?s("VuePerfectScrollbar",{staticStyle:{"max-height":"550px"},attrs:{settings:{maxScrollbarLength:160,wheelSpeed:.6}}},[s("ul",{staticClass:"pt-2 text-sm overflow-hidden"},t._l(t.comments,function(e,n){return s("li",{key:n,staticClass:"msg relative mb-2",class:{"px-1 py-2 bg-gray-100 rounded-lg":t.currMsg===e._id},staticStyle:{transition:"all 0.3s"}},[s("div",{staticClass:"flex items-center"},[s("vs-avatar",{attrs:{src:e.sender.avatar_url+"?imageView2/2/w/50"},on:{click:function(s){return t.viewUserDetail(e.sender._id)}}}),s("p",{staticClass:"name ml-1"},[t._v("\n            "+t._s(e.sender.nickname)+"\n          ")]),e.sender._id===t.owner?s("p",{staticClass:"owner ml-1"},[t._v("主人")]):t._e(),s("p",{staticClass:"ml-2 text-xs text-gray"},[t._v("\n            "+t._s(t.$timeDiff(e.created_at))+"\n          ")])],1),s("p",{staticClass:"ml-8 text-gray"},[t._v(t._s(e.content))]),e.replies.length>0?s("ul",{staticClass:"ml-6 p-2 bg-gray rounded-lg"},t._l(e.replies,function(e,n){return s("li",{key:n},[s("p",[s("span",[s("span",{staticClass:"name cursor-pointer",on:{click:function(s){return t.viewUserDetail(e.sender._id)}}},[t._v(t._s(e.sender.nickname))]),e.sender._id===t.owner?s("span",{staticClass:"owner cursor-default"},[t._v("主人")]):t._e()]),s("span",{staticClass:"mx-1 text-gray"},[t._v("回复")]),s("span",[s("span",{staticClass:"name cursor-pointer",on:{click:function(s){return t.viewUserDetail(e.at._id)}}},[t._v(t._s(e.at.nickname))]),e.at._id===t.owner?s("span",{staticClass:"owner cursor-default"},[t._v("主人")]):t._e(),t._v("\n                :\n              ")]),s("span",{staticClass:"text-gray"},[t._v("\n                "+t._s(e.content)+"\n              ")])])])}),0):t._e(),s("span",{staticClass:"comment-block absolute top-0 right-0 mt-3 text-gray text-xs hidden cursor-pointer",on:{click:function(s){return t.changeGoodsComments(e._id)}}},[t._v("屏蔽此留言")])])}),0)]):s("p",{staticClass:"p-3 text-center text-sm text-gray bg-gray rounded-lg"},[t._v("\n    暂时还没有留言\n  ")]),t.showComments&&!t.hideComment?s("div",[s("vs-pagination",{attrs:{total:Math.ceil(t.total/5)},model:{value:t.currPage,callback:function(e){t.currPage=e},expression:"currPage"}})],1):t._e(),t.hideComment?s("div",{staticClass:"hide-comment absolute left-0 bottom-0 w-full text-sm text-center text-gray",on:{click:function(e){return t.showMoreComments()}}},[t._v("\n    查看更多留言\n  ")]):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mb-1 flex justify-between items-center"},[e("span",{staticClass:"mb-2 text-primary"},[this._v("留言板")])])}],!1,null,"ae42fa72",null).exports},data:function(){return{goodsId:"",goods:{},comments:[],pagination:{},seller:{avatar_url:"",nickname:"----",school:{name:"-----"},gender:"",credit_value:0,fans:[],published_goods:[]}}},mounted:function(){this.goodsId=this.$route.query.goodsId,this.getGoodsDetail(),this.getGoodsSeller(),this.getGoodsComments()},methods:{getGoodsDetail:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(){var e,s,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(a.c)({goods_id:this.goodsId});case 2:if(e=t.sent,s=e.code,n=e.data.goods_detail,2e3!==s){t.next=9;break}if(!n){t.next=9;break}return this.goods=n,t.abrupt("return");case 9:this.$router.replace("/not-found");case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getGoodsSeller:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(){var e,s,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(a.j)({goods_id:this.goodsId});case 2:e=t.sent,s=e.code,n=e.data,2e3===s&&(this.seller=n.seller);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getGoodsComments:function(){var t=Object(n.a)(regeneratorRuntime.mark(function t(){var e,s,n,r,i=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:1,t.next=3,Object(a.b)({goods_id:this.goodsId,page:e,page_size:5});case 3:s=t.sent,n=s.code,r=s.data,2e3===n&&(this.comments=r.comments,this.pagination=r.pagination);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}}),v=Object(o.a)(p,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex flex-wrap"},[s("div",{staticClass:"pr-3",staticStyle:{width:"68%"}},[s("DetailInfo",{attrs:{goods:t.goods,goodsId:t.goodsId}})],1),s("div",{staticClass:"pl-3",staticStyle:{width:"32%"}},[s("DetailUser",{attrs:{seller:t.seller}}),s("DetailComment",{staticClass:"mt-6",attrs:{comments:t.comments,goodsId:t.goodsId,owner:t.seller._id,total:t.pagination.total},on:{refreshComments:function(e){return t.getGoodsComments()},switchPage:function(e){t.getGoodsComments(e)}}})],1)])},[],!1,null,null,null);e.default=v.exports}}]);