(window.webpackJsonp=window.webpackJsonp||[]).push([["AdminEdit"],{"202e":function(e,t,a){},"3bda":function(e,t,a){"use strict";const r=(e,t,a)=>{t?/^[\d\w\u4e00-\u9fa5,.;:"'?!-]{2,12}$/.test(t)||a(new Error("昵称的格式不正确")):a(new Error("请填写昵称")),a()},s=(e,t,a)=>{t?/^[\u4e00-\u9fa5]{1,6}(·[\u4e00-\u9fa5]{1,6}){0,2}$/.test(t)||a(new Error("姓名的格式不正确")):a(new Error("请填写姓名")),a()},i=(e,t,a)=>{t?/^[\w.-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,3}$/.test(t)||a(new Error("邮箱的格式不正确")):a(),a()};var n={name:"EditForm",props:{formData:Object},data:()=>({form:{},rules:{nickname:[{validator:r,trigger:"blur"}],real_name:[{validator:s,trigger:"blur"}],email:[{validator:i,trigger:"blur"}]}}),watch:{formData:{handler(e){this.form=e||{account:"",nickname:"",real_name:"",email:""}},immediate:!0}},methods:{submit(){let e;return this.$refs.form.validate(t=>t?(e=!0,!0):(e=!1,!1)),e}}},o=(a("83ca"),a("2877")),l=Object(o.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",staticClass:"edit",attrs:{"hide-required-asterisk":"",rules:e.rules,model:e.form}},[a("el-form-item",{attrs:{label:"登入账号",prop:"account",required:""}},[a("el-input",{attrs:{placeholder:"请填写登入账号"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1),a("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[a("el-input",{attrs:{placeholder:"只能是中文、字母、数字"},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),a("el-form-item",{attrs:{label:"真实姓名",prop:"real_name"}},[a("el-input",{model:{value:e.form.real_name,callback:function(t){e.$set(e.form,"real_name",t)},expression:"form.real_name"}})],1),a("el-form-item",{attrs:{label:"邮箱（选填）",prop:"email"}},[a("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1)],1)},[],!1,null,"17dcd5f5",null);t.a=l.exports},4411:function(e,t,a){"use strict";a("ac6a");var r={name:"EditPermission",props:{editable:{type:Boolean,default:!1},allSelected:Boolean,permissions:Array},data:()=>({per:[],modules:{user:"用户",goods:"商品",order:"订单",comment:"留言",guide:"指引",admin:"管理员"},actions:["read","write","create","delete"]}),watch:{permissions:{handler(e){e?this.setPermissions():this.initValues()},immediate:!0},allSelected(e){this.setAllCheckboxStatus(e)}},methods:{initValues(){const e=[{read:!1},{write:!1},{create:!1},{delete:!1}];this.per=Object.keys(this.modules).map(t=>({module:t,purview:this.$cloneDeepWith(e)}))},setPermissions(){const e=this.$cloneDeepWith(this.permissions);this.per=Object.keys(this.modules).map(t=>{for(const a of e)if(a.module===t)return{module:t,purview:this.actions.map(e=>{const t={};return t[`${e}`]=a.purview.includes(e),t})};return{module:t,purview:[{read:!1},{write:!1},{create:!1},{delete:!1}]}})},setAllCheckboxStatus(e){this.per.forEach(t=>{t.purview.forEach((t,a)=>{t[this.actions[a]]=e})})},getPermissions(){return this.per.map(e=>({module:e.module,purview:e.purview.filter((e,t)=>e[this.actions[t]]).map(e=>Object.keys(e)[0])}))}}},s=(a("9e95"),a("2877")),i=Object(s.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.per?a("table",{staticClass:"permission"},[e._m(0),e._l(e.per,function(t,r){return a("tr",{key:r},[a("td",[e._v(e._s(e.modules[t.module]))]),e._l(t.purview,function(t,r){return a("td",{key:r},[a("vs-checkbox",{class:{"pointer-events-none":!e.editable},attrs:{disabled:!e.editable},model:{value:t[e.actions[r]],callback:function(a){e.$set(t,e.actions[r],a)},expression:"td[actions[j]]"}})],1)})],2)})],2):e._e()])},[function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("th",[this._v("Module")]),t("th",[this._v("Read")]),t("th",[this._v("Write")]),t("th",[this._v("Create")]),t("th",[this._v("Delete")])])}],!1,null,"19adfc7a",null);t.a=i.exports},"577c":function(e,t,a){"use strict";a.r(t);var r=a("1da1"),s=a("b0e1"),i=a("3bda"),n=a("bb2a"),o=a("4411"),l=a("518e"),d={name:"AdminEdit",components:{EditAvatar:s.a,EditForm:i.a,EditPassword:n.a,EditPermission:o.a},data:()=>({info:{},detail:{}}),created(){this.getAdminDetail()},methods:{getAdminDetail(){var e=this;return Object(r.a)(function*(){const t=yield Object(l.d)({admin_id:e.$route.query.adminId}),a=t.code,r=t.data.admin_detail;2e3===a&&(e.detail=r,e.info={_id:r._id,nickname:r.nickname,real_name:r.real_name,email:r.email})})()},onUpdateAmin(){var e=this;this.$refs.editForm.submit()&&this.$loading(Object(r.a)(function*(){const t=Object.assign({admin_id:e.info._id,gender:e.$refs.editAvatar.selectedGender,permissions:e.$refs.editPermissions.getPermissions()},e.$refs.editForm.form),a=yield Object(l.l)(t),r=a.code,s=a.msg;if(2e3!==r)throw new Error(s);yield e.getAdminDetail(),e.$vs.notify({title:"信息更新成功",text:s,color:"success"})}),{container:"#main",scale:1},null,e=>{this.$vs.notify({title:"信息更新失败",text:e,color:"danger"})})}}},c=(a("6cbd"),a("2877")),m=Object(c.a)(d,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("vs-tabs",{staticClass:"p-6 bg-main vs-con-loading__container",attrs:{id:"main"}},[a("vs-tab",{staticClass:"px-4 py-10",attrs:{icon:"el-icon-user","icon-pack":"el-icon",label:"账号信息"}},[a("div",{staticClass:"mb-8 flex"},[a("div",{staticClass:"mr-16"},[a("EditAvatar",{ref:"editAvatar",attrs:{"admin-id":e.detail._id,avatar:e.detail.avatar_url,gender:e.detail.gender},on:{updateInfo:function(t){return e.getAdminDetail()}}})],1),a("div",{staticClass:"w-1/2"},[a("EditForm",{ref:"editForm",attrs:{"form-data":e.info}})],1)]),a("div",{staticClass:"mb-5 p-5 rounded-lg border-primary",staticStyle:{"border-width":"1px","border-style":"solid"}},[a("p",{staticClass:"text-lg text-semi"},[e._v("权 限")]),a("vs-divider"),a("EditPermission",{ref:"editPermissions",attrs:{permissions:e.detail.permissions,editable:!0}})],1),a("div",{staticClass:"flex"},[a("vs-button",{staticClass:"save ml-auto",on:{click:function(t){return e.onUpdateAmin()}}},[e._v("保存设置")])],1)]),a("vs-tab",{staticClass:"px-4 py-10",attrs:{icon:"el-icon-key","icon-pack":"el-icon",label:"安全设置"}},[a("div",{staticClass:"w-1/2"},[a("EditPassword"),a("vs-button",{attrs:{id:"btn"}},[e._v("确认修改密码")])],1)])],1)],1)},[],!1,null,"0970e7c6",null);t.default=m.exports},"6cbd":function(e,t,a){"use strict";var r=a("702e");a.n(r).a},"702e":function(e,t,a){},"83ca":function(e,t,a){"use strict";var r=a("dd8e");a.n(r).a},"86df":function(e,t,a){},"9e95":function(e,t,a){"use strict";var r=a("86df");a.n(r).a},b0e1:function(e,t,a){"use strict";var r=a("8bbf");const s=a.n(r).a.component("ReplaceAvatar",()=>Promise.all([a.e("chunk-15f04740"),a.e("chunk-f438a7e6")]).then(a.bind(null,"0a78"))),i={male:"https://cdn.hrspider.top/default_avatar_male.jpg",female:"https://cdn.hrspider.top/default_avatar_female.jpg"};var n={name:"EditAvatar",components:{ReplaceAvatar:s},props:{adminId:String,avatar:String,gender:Number},data:()=>({defaultAvatar:i,selectedGender:0,avatarUrl:"https://cdn.hrspider.top/default_avatar_male.jpg",showAvatarPopup:!1}),watch:{selectedGender:{handler(e){const t=this.defaultAvatar,a=t.male,r=t.female;this.avatarUrl!==a&&this.avatarUrl!==r||(this.avatarUrl=e?r:a)},immediate:!0},avatar:{handler(e){(null==e?void 0:e.length)>0&&(this.avatarUrl=e)},immediate:!0},gender:{handler(e){e&&(this.selectedGender=e)},immediate:!0}}},o=a("2877"),l=Object(o.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("img",{staticClass:"heavy-shadow radius",attrs:{width:"150px",src:e.avatarUrl}}),a("div",{staticClass:"my-3  flex"},[a("div",{staticClass:"mr-3 px-3 py-1 primary rounded-lg cursor-pointer",staticStyle:{background:"rgba(var(--vs-primary), 0.1)"},on:{click:function(t){e.selectedGender=0}}},[e._v("\n      汉子\n      "),a("i",{directives:[{name:"show",rawName:"v-show",value:!e.selectedGender,expression:"!selectedGender"}],staticClass:"el-icon-check"})]),a("div",{staticClass:"px-3 py-1 danger rounded-lg cursor-pointer",staticStyle:{background:"rgba(var(--vs-danger), 0.1)"},on:{click:function(t){e.selectedGender=1}}},[e._v("\n      妹纸\n      "),a("i",{directives:[{name:"show",rawName:"v-show",value:e.selectedGender,expression:"selectedGender"}],staticClass:"el-icon-check"})])]),e.adminId?a("vs-button",{staticClass:"w-full max-w-xs",attrs:{size:"small",type:"border"},on:{click:function(t){e.showAvatarPopup=!0}}},[e._v("更换头像")]):e._e(),a("ReplaceAvatar",{ref:"replaceAvatar",attrs:{"admin-id":e.adminId,popupActive:e.showAvatarPopup},on:{updateInfo:function(t){return e.$emit("updateInfo")},closePopup:function(t){e.showAvatarPopup=!1}}})],1)},[],!1,null,null,null);t.a=l.exports},bb2a:function(e,t,a){"use strict";const r=(e,t,a)=>{t||a(new Error("请填写原始密码")),a()},s=(e,t,a)=>{t?/^[\w]{6,16}$/.test(t)||a(new Error("密码不符合规范")):a(new Error("请填写密码")),a()};var i={name:"EditPassword",data(){return{form:{oldPassword:"",password:"",password2:""},rules:{oldPassword:[{validator:r,trigger:"blur"}],password:[{validator:s,trigger:"blur"}],password2:[{validator:(e,t,a)=>{t?t!==this.form.password&&a(new Error("与前一次密码不一致")):a(new Error("请确认二次密码")),a()},trigger:"blur"}]}}},methods:{submit(){let e;return this.$refs.form.validate(t=>t?(e=!0,!0):(e=!1,!1)),e}}},n=(a("ea7f"),a("2877")),o=Object(n.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",staticClass:"edit",attrs:{"label-position":"top",rules:e.rules,model:e.form}},[a("el-form-item",{attrs:{label:"原始密码",prop:"oldPassword"}},[a("el-input",{attrs:{type:"password",placeholder:"请填写账号原始密码"},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"6-16个字符，只能是字母、数字和下划线"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"password2"}},[a("el-input",{attrs:{type:"password",placeholder:"请再次输入密码"},model:{value:e.form.password2,callback:function(t){e.$set(e.form,"password2",t)},expression:"form.password2"}})],1)],1)],1)},[],!1,null,"9c93887c",null);t.a=o.exports},dd8e:function(e,t,a){},ea7f:function(e,t,a){"use strict";var r=a("202e");a.n(r).a}}]);